<?xml version="1.0"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" styleName="application" creationComplete="start();">
    <mx:Style source="default.css"/>
    <mx:Canvas id="playground" styleName="playground" width="100%" height="100%" clipContent="false"/>

    <mx:Script><![CDATA[
        import model.IDuck;
        import model.PlayModel;

        import view.DuckShape;

        public static const ADVANCE_DELAY: int = 50; // ms
        public static const NEW_DUCK_DELAY: int = 2000; // ms

        private var _model: PlayModel;

        private function start(): void {
            _model = new PlayModel(visibleAreaProvider);

            var advanceTimer: Timer = new Timer(ADVANCE_DELAY);
            advanceTimer.addEventListener(TimerEvent.TIMER, function(e: TimerEvent) {
                _model.advanceAllDucks();
            });
            advanceTimer.start();

            var newDuckTimer: Timer = new Timer(NEW_DUCK_DELAY);
            newDuckTimer.addEventListener(TimerEvent.TIMER, function(e: TimerEvent) {
                newDuck();
            });
            newDuckTimer.start();

            newDuck();
        }

        private function visibleAreaProvider(): Rectangle {
            return new Rectangle(0, 0, playground.width, playground.height);
        }

        private function newDuck(): void {
            var duck: IDuck = _model.createNewDuck();
            var shape: DuckShape = new DuckShape(duck);
            shape.addEventListener(MouseEvent.MOUSE_DOWN, hit);
            playground.addChild(shape);
        }

        private function hit(event: MouseEvent): void {
            var duckShape: DuckShape = DuckShape(event.target);
            duckShape.hit();
        }

        ]]></mx:Script>
</mx:Application>
